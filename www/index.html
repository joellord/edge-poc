<html>
  <head>
    <title>Who dis?</title>
  </head>

  <body>
    <h1>Who is this?</h1>

    <pre id="response"></pre>

    <input type="file" id="analyze"/>
    <canvas width="500" height="500" id="canvas" />

  </body>

  <script src="/js/face-api.js"></script>
  <script type="text/javascript">
  let ready = true;
  let labeledFaceDescriptors;

  let file = document.querySelector("#analyze");
  let codeBlock = document.querySelector("#response");

  const loadImage = () => {  
    if (!ready) {
      alert("Models and configuration not loaded yet, please wait a minute");
      return;
    }
    let canvas = document.querySelector("canvas");
    let ctx = canvas.getContext("2d");

    let reader = new FileReader();
    reader.onload = function(event){
        let img = new Image();
        img.onload = async function(){
          let imageRatio = img.width / img.height;
          canvas.height = 500;
          canvas.width = 500 * imageRatio;
          ctx.drawImage(img, 0, 0, img.width, img.height, 0, 0, canvas.width, canvas.height);
          let input = img;
          let imgData = canvas.toDataURL();
          const response = await fetch("/detection", {
            method: 'POST', 
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({imgData})
          }).then(resp => resp.json());
          codeBlock.innerText = JSON.stringify(response, null, 2);
        }
        img.src = event.target.result;
    }
    if (file) {
      reader.readAsDataURL(file.files[0]);
    } 
  }

  file.addEventListener("change", loadImage);

  </script>

  </html>